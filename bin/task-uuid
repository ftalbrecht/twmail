#!/bin/bash

#
# Creates a new task using TaskWarrior and prints its UUID to STDOUT.
#

# 1. Make a temporary tag that unlikely to exist yet.
# To avoid shell troubles, we have it start with a character.
START_CHAR=T
TEMP_TAG="$START_CHAR$(md5 -qs $(uuidgen))"

# 2. Create the new task tagged with our temporary tag
task rc.verbose=nothing add +"$TEMP_TAG" $* || { exit $?; }

# 3. Remember the UUID generated by TaskWarrior
TASK_UUID=$(task +"$TEMP_TAG" uuid)

# 4. Remove the temporary tag from the new task
task rc.verbose=nothing $TASK_UUID modify -"$TEMP_TAG"

# 5. Print the UUID to STDOUT
echo $TASK_UUID
