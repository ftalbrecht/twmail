#!/usr/bin/env ruby
require 'securerandom'

#
# Creates a new task using TaskWarrior and prints its UUID to STDOUT.
#

# 1. Make a temporary tag that unlikely to exist yet.
# To avoid shell troubles, we have it start with a character.
tag = "T#{SecureRandom.hex}"

# 2. Create the new task tagged with our temporary tag
%x|task rc.verbose=nothing add +#{tag} #{ARGV.join(' ')}|

# 3. Remember the UUID generated by TaskWarrior
task_uuid = %x|task "+#{tag}" uuid|

# 4. Remove the temporary tag from the new task
%x|task rc.verbose=nothing '#{task_uuid}' modify -#{tag}|

# 5. Print the UUID to STDOUT
puts task_uuid
